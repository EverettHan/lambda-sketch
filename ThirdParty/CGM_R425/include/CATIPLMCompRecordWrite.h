// COPYRIGHT Dassault Systemes 2003
//===================================================================
//
// CATIPLMCompRecordWrite.h
// Define the CATIPLMCompRecordWrite interface
//
//===================================================================
//
// Usage notes:
//   New interface: describe its use here
//
//===================================================================
//  Dec 2003  Creation: Code generated by the CAA wizard  jvm
//===================================================================
/**
* @level Protected
* @usage U3
*/
#ifndef CATIPLMCompRecordWrite_H
#define CATIPLMCompRecordWrite_H

#include "CATPLMServicesItf.h"
#include "CATBaseUnknown.h"
#include "CATPLMStrongRelationshipId.h"
#include "CATIAV5Level.h"

#ifndef LOCAL_DEFINITION_FOR_IID
extern ExportedByCATPLMServicesItf IID IID_CATIPLMCompRecordWrite;
#else
extern "C" const IID IID_CATIPLMCompRecordWrite;
#endif

class CATPLMID;
class CATPLMTypeId;
class CATPLMType;
class CATIPLMAttrWrite;
class CATUnicodeString;
class CATVVSUrl;
class CATString;
class _SEQUENCE_octet;
class CATPLMSemanticRelationData;
class CATPLMStreamDescriptor;
class CATComponentId;
class CATPLMTypeH;
class CATPLMPathDataH;

//
#include "CATCollec.h"
class CATPLMSemanticRelation;
class CATListPtrCATPLMSemanticRelation;
class CATPLMSemanticRelationId;
//

/**
* Interface belonging to the <b>Component services</b>.
* Using this level of abstraction you manipulate only Componet Id without knowing the PDM it belongs to.<br>
*
* Provides methods in order to Create/Delete or Update current object.
* The Update operation is the default behavior.
* This operation can be done under the control of a transaction of the PDM(s).
* Update/Create/Delete operations are inserted in it.
*
* By calling the Commit() method, the save engine commit in the PDM all the
* elementary operations included in the record.
*/
class ExportedByCATPLMServicesItf CATIPLMCompRecordWrite : public CATBaseUnknown
{
  CATDeclareInterface;

public:
  /**
  * Returns the CATPlmId of this Record (of the current object).
  * @param  oId
  *    The PLMId of the object to modify
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT GetPLMId(CATPLMID& oId) = 0;

  /**
  * Create the object already identified.
  *
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>S_FALSE</dt><dd>The input Identifier does not represent an object belonging to the PDM associated to the transaction.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT CreateObject() = 0;

  /**
  * Update the object already identified.
  *
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>S_FALSE</dt><dd>The input Identifier does not represent an object belonging to the PDM associated to the transaction.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT UpdateObject() = 0;

  /**
  * Delete the object.
  *
  * WARNING: 
  * If creation of minor version of current RecordWrite is authorized (<Property Name="NewMinorRevisionAvailability" Value="Yes"/>) and if object inherits from PLMReference, please use CATIPLMCompDeleteRefTransaction.
  * Don't use current method CATIPLMCompRecordWrite::DeleteObject().
  *
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT DeleteObject() = 0;

  /**
  * @deprecated V5R14 ReplaceObject
  * no doc
  * Not possible to make a replace directly by providers.
  */
  virtual HRESULT ReplaceObject(const CATPLMID& iId) = 0;

  /**
  * Log an attributes update. This method computes a CATIImmObjectAttr interface for the dedicated object.
  * The return interface will be used by the system to update attributes.
  * This attribute update is also used for Creation request.
  *
  * @param  iExtensionType
  *    Applicative extension type
  *    if Not Valuated -> Attributes belong to the Master Bloc (MBSI)
  *    if Valued -> Attributes belong to the Slave Bloc (SBSI) corresponding to iExtensionType
  * @param  oAttrAccess [out, CATBaseUnknown#Release]
  *    interface managing attributes setting
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT GetAttributeAccess(const CATString* iExtensionType, CATIPLMAttrWrite** oAttrAccess) = 0;

  /**
  * Log an attributes update. This method computes a CATIPLMAttrWrite interface for the dedicated object.
  * The return interface will be used by the system to update attributes.
  *
  * @param  oAttrAccess [out, CATBaseUnknown#Release]
  *    interface managing attributes setting
  * @param  iExtensionType
  *    Applicative extension type
  *    if NULL (Default) -> Attributes belong to the Master Bloc (MBSI)
  *    if Valued -> Attributes belong to the Slave Bloc (SBSI) corresponding to iExtensionType
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT GetAttributeAccess(CATIPLMAttrWrite** oAttrAccess, const CATPLMTypeId* iExtensionType = NULL) = 0;

  /**
  * Log an attributes update. This method computes a CATIPLMAttrWrite interface for the dedicated object.
  * The return interface will be used by the system to update attributes.
  *
  * @param  opAttrAccess [out, CATBaseUnknown#Release]
  *    interface managing attributes setting
  * @param  ipExtensionType
  *    Applicative extension type
  *    if NULL (Default) -> Attributes belong to the Master Bloc (MBSI)
  *    if Valued -> Attributes belong to the Slave Bloc (SBSI) corresponding to ipExtensionType
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT GetAttributeAccess(CATPLMType* ipExtensionType, CATIPLMAttrWrite*& opAttrAccess) = 0;

  /**
  * AddOrOverwrite the stream of an object.
  *
  * This operation has a sense when you create or update an object.
  *
  * Log a stream update or a stream creation
  * The system send this operation during the save process. The return message will be used by the application to access the stream and write in the vault.
  *
  * Several streams can be associated to a single object. The iStreamDesc parameter identifies and describes the stream.
  * (sample: a DV can have a MASTER representation and a CGR one)
  * This method can be called several time on this record with different stream descriptor.
  * If the object is modified and ResetStream is not called, the stream list is only updated with this new list.
  * So, the action has a behavior of "Add or Overwrite".
  * If ResetStream is called, the action has a behavior of "Forget and Rewrite".
  *
  * @param  iStreamDesc
  *         The CATPLMStreamDescriptor of the Stream.(Format, Role, TypeLate, MarkStamp...)
  *
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT ReserveStream(const CATPLMStreamDescriptor* iStreamDesc) = 0;

  /**
  * Delete the stream of an object.
  *
  * This operation has no sense when you create an object (E_FAIL).
  * This operation has a sense when you update an object.
  *
  * note1:
  * If you request the deletion of a stream that has already been deleted or that has never existed,
  * the save transaction must pursue its execution and ends successfully
  * note2:
  * If you request in the same transaction the creation and the deletion of the same stream,
  * the save transaction must fail.
  *
  * @param  iStreamDesc
  *         The CATPLMStreamDescriptor of the Stream.(Format, Role, TypeLate, MarkStamp...)
  *
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT DeleteStream(CATPLMStreamDescriptor* iStreamDesc) = 0;

  /**
  * Reset the streams of an object.
  *
  * We destroy all streams that exist on an object and we set all streams described in the Rewrite order
  *
  * This operation has no sense when you create an object (E_FAIL).
  * This operation has a sense when you update an object.
  *
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT ResetStream() = 0;

  /**
  * @deprecated
  * Please use HRESULT SetAssociatedObj(CATPLMStrongRelationshipId::eStrongRelId iStrongRelId,const CATPLMID & iTargetId);
  */
  virtual HRESULT SetAssociatedObject(const CATString* iRelType, const CATPLMID& iTargetId) = 0;

  /**
  * Define basic Relation.
  * Ownership, Instance-Reference.
  *
  * @param  iRelType
  *    iRelType of the relation: from, to, fromrel (if it exists), torel (if it exists), V_Owner (deprecated, please use from), V_InstanceOf (deprecated, please use to)
  * @param  iTargetId
  *    Id of the Targeted object
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT SetAssociatedObj(CATPLMStrongRelationshipId::eStrongRelId iStrongRelId, const CATPLMID& iTargetId) = 0;

  virtual HRESULT GetAssociatedObj(CATPLMStrongRelationshipId::eStrongRelId iStrongRelId, CATPLMID& oTargetId) = 0;

  /**
  * Add a semantic Relation.
  * The complete set of Semantic Relations needs to be re-described, not just the modified.
  * All semantic relations involving in this method have to be considered as the new complete array of Semantic relations of the recordWrite.
  * It means That at the end of the RecordWrite filling (::Next call), the old array of Semantic relations is replaced by the new one.
  *
  * To delete the existing Semantic relations array @see DeleteSemanticRelations
  *
  * @param  iTargetId
  *    Id of the targeted object
  * @param  iSemanticData
  *    the CATPLMSemanticRelationData object
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT AddSemanticRelation(const CATPLMID& iTargetId, const CATPLMSemanticRelationData* iSemanticData) = 0;

  /**
  * Add a path data.
  *
  * RESTRICTION: Current method doesn't work on PathDatas that contain a PathType that inherits from SemanticRelation
  *              Current method only works on pure PathTypes that DON'T inherit from SemanticRelation
  *
  *              Current method works with import engine (create object, update object) for level >= 2019x (for level 2018x, contact PLMAdapter team, it is not available on all FDs)
  *              Current method works with save engine (create object, update object) for level >= 2020x (for level 2019x, contact PLMAdapter team, it is not available on all FDs)
  *
  * @param  iPathData
  *    the path data of object
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT AddPathDataH(const CATPLMPathDataH& iPathData) = 0;

  /**
  * Modify a path data.
  *
  * RESTRICTION: Current method doesn't work on PathDatas that contain a PathType that inherits from SemanticRelation
  *              Current method only works on pure PathTypes that DON'T inherit from SemanticRelation
  *
  *              Current method works with import engine (create object, update object) for level >= 2019x (for level 2018x, contact PLMAdapter team, it is not available on all FDs)
  *              Current method works with save engine (create object, update object) for level >= 2020x (for level 2019x, contact PLMAdapter team, it is not available on all FDs)
  *
  * @param  iPathData
  *    the path data of object
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT ModPathDataH(const CATPLMPathDataH& iPathData) = 0;

  /**
  * Delete a path data.
  *
  * RESTRICTION: This method doesn't work on PathDatas that contain a PathType that inherits from SemanticRelation
  *              Current method only works on pure PathTypes that DON'T inherit from SemanticRelation
  *
  *              Current method works with import engine (create object, update object) for level >= 2019x (for level 2018x, contact PLMAdapter team, it is not available on all FDs)
  *              Current method works with save engine (create object, update object) for level >= 2020x (for level 2019x, contact PLMAdapter team, it is not available on all FDs)
  *
  * @param  iPathData
  *    the path data of object
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT DelPathDataH(const CATPLMPathDataH& iPathDatas) = 0;
  // @deprecated replaced by DelPathDataH
  virtual HRESULT DeletePathDataH(const CATPLMPathDataH& iPathDatas) = 0;

  /**
  * Deletes all semantic relations of this record.
  *
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>

  */
  virtual HRESULT DeleteSemanticRelations() = 0;

  /**
  * Add Semantic Relations from a list. It replace/remove the existing SRs if any.
  *
  * @param  iSRList
  *    the list of CATPLMSemanticRelation objects
  * @return
  *    Error code of function :
  *   <dl>
  *     <dt>S_OK</dt>
  *     <dd>operation is successfully.</dd>
  *     <dt>E_FAIL </dt>
  *     <dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT SetSRList(const CATLISTP(CATPLMSemanticRelation)& iSRList) = 0;

  /**
  * Delta-Save of Semantic Relations : push an SR into the list of elements to ADD.
  *
  * @param  iSRList
  *    The CATPLMSemanticRelation to add in the list of object to ADD
  * @return
  *    Error code of function :
  *   <dl>
  *     <dt>S_OK</dt>
  *     <dd>operation is successfully.</dd>
  *     <dt>E_FAIL </dt>
  *     <dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT PushSRForAdd(const CATPLMSemanticRelation& iSR) = 0;

  /**
  * Delta-Save of Semantic Relations : push an SR into the list of elements to SYNC.
  *
  * @param  iSRList
  *    The CATPLMSemanticRelation to add in the list of object to SYNC
  * @return
  *    Error code of function :
  *   <dl>
  *     <dt>S_OK</dt>
  *     <dd>operation is successfully.</dd>
  *     <dt>E_FAIL </dt>
  *     <dd>A problem occurs during the operation./dd>
  *   </dl>
  */
  virtual HRESULT PushSRForSync(const CATPLMSemanticRelation& iSR) = 0;

  /**
  * Delta-Save of Semantic Relations : push an SR into the list of elements to DELETE.
  *
  * @param  iSRId
  *    The CATPLMSemanticRelationId to add in the list of object to DELETE
  * @return
  *    Error code of function :
  *   <dl>
  *     <dt>S_OK</dt>
  *     <dd>operation is successfully.</dd>
  *     <dt>E_FAIL </dt>
  *     <dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT PushSRIdForDel(const CATPLMSemanticRelationId& iSRId) = 0;

  /**
  * Removes an extension from an existing object.
  * Note : Should be used only in case of Update.
  *
  * @param  iExtensionType
  *    Applicative extension type
  *
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT RemoveExtension(const CATPLMTypeId& iExtensionType) = 0;

  /**
  * Removes an extension from an existing object.
  * Note : Should be used only in case of Update.
  *
  * @param  iExtensionType
  *    Applicative extension type
  *
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT RemoveExtension(CATPLMType* ipExtensionType) = 0;

  /**
  * Set the POV identifier.
  * Note : Should be used only in case of M1 server.
  *
  * @param  iInitPOVFromSelf
  *    A boolean.
  *
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dtS_FALSE</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  */
  virtual HRESULT SetInitPOVFromSelf(CATBoolean iInitPOVFromSelf) = 0;

  // ------------------------------------------------------------------
  // ------------------------------------------------------------------
  // composition functionality
  // ------------------------------------------------------------------
  // ------------------------------------------------------------------
  /**
  * Mandatory for Rep once instantiable - It is not real composition - Thanks to call made on SetComposerId, P&O is same for Rep once instantiable and for parent BO.
  * Optional  for Port and Connection if and only if V_Owner is correctly filled (In this case, PLMAdapter layer calls SetComposerId with plmid of V_Owner) - It is real composition.
  * If you have your own model which uses composition functionality, please use HRESULT SetComposerAndComposition(const CATPLMID& iComposer, const CATPLMID& iCompositionalRelId).
  */
  virtual HRESULT SetComposerId(const CATPLMID& iComposer) = 0;

  //@deprecated on level >=424, please use SetComposerAndComposition(const CATPLMID&, const CATPLMID&)
  virtual HRESULT SetComposition(const CATPLMTypeH& iCompositionalRelType) = 0;

#ifdef CATIAR423
  //@deprecated on level >=424, please use SetComposerAndComposition(const CATPLMID&, const CATPLMID&)
  virtual HRESULT SetComposition(const CATPLMID& iCompositionalRelId) = 0;
#endif

  //@deprecated on level >=424, please use SetComposerAndComposition(const CATPLMID&, const CATPLMID&)
  virtual HRESULT SetComposerAndComposition(const CATPLMID& iComposer, CATPLMType* ipCompositionalRelType) = 0;

#ifdef CATIAR423
  /**
  * Add:
  * 1- Composer Id    that is the PLMId of the aggregatING component.
  * 2- composition Id that is the PLMId of the relationship that link the aggregatING component (<=> composER) to the aggregatED component (composEE).
  * Note : Should be used only in case of Import Create/Save Create on M1 server.
  *
  * example given:
  * A (VPMRepReference) (<=> composER)
  * (physicalid_A, logicalid_A, majorid_A)
  *  ^
  *  |
  *  from
  *  |
  *  |_ B (DerivedOutputRelationship) --------------------- to --------------> C (DerivedOutputEntity) (<=> composEE)
  *     (physicalid_B, logicalid_B, majorid_B)                                 (physicalid_C, logicalid_C, majorid_C)
  *
  * PLMQL:
  * "IMPORT CREATED"/"SAVE CREATED"
  *    Class DerivedOutputEntity (physicalid, logicalid, majorid, name, policy)
  * VALUES
  *    (x'physicalid_C', x' logicalid_C', x' majorid_C', 'ImportedComposeeCBPObj_uuid', 'VPLM_PRIVATE')
  * composer plmid of composER composition_rel plmid of composEE ;
  *
  * @param  iComposer
  *    The PLMId of the aggregatING component (A) (<=> composER): it used on aggregatED Business Object (C) (<=> composEE) giving component aggregatING Business Object (A) (<=> composER).
  * @param  iCompositionalRelId
  *    The plmid of the relationship linking aggregatING component (A) to aggregatED component (C).
  *
  * metadata:
  * -On C, we find: BO  (‘E’ of ER) « composed » => ObjectNature="Aggregated" in « metadata »
  * -On B, we find: REL (‘R’ de ER) « compositional» => RelationNature="Aggregation" in « metadata »
  *
  * @return
  *   <dl>
  *     <dt>S_OK</dt><dd>operation is successfully.</dd>
  *     <dt>E_FAIL</dt><dd>A problem occurs during the operation.</dd>
  *   </dl>
  *
  * WARNING: SetComposerAndComposition must be used at creation step on composEE. It mustn't be used when you updating composEE
  */
  virtual HRESULT SetComposerAndComposition(const CATPLMID& iComposer, const CATPLMID& iCompositionalRelId) = 0;
#endif
};

#endif
