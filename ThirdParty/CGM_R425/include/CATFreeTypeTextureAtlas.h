//===================================================================
// COPYRIGHT DS SolidWorks Corporation 2011/10/24
//===================================================================
// CATFreeTypeTextureAtlas.cpp
// Header definition of class CATFreeTypeTextureAtlas
//===================================================================
//
// 2013/04/22 VZ2 Moved from Opengl.m for the VID immediate engine
//
//===================================================================
//  2011/10/24 Creation: Code generated by the 3DS wizard
//===================================================================

#ifndef CATFreeTypeTextureAtlas_H
#define CATFreeTypeTextureAtlas_H

#include "SGInfra.h"
#include "CATFreeType.h"
#include "CATBoolean.h"
#include "CATBaseUnknown.h"
#include "vector.h"
#include "CATVisRectPacker.h"

class CATTexturePixelImage;
//-----------------------------------------------------------------------

class ExportedBySGInfra CATFreeTypeTextureAtlas: public CATBaseUnknown
{
public:
	CATFreeTypeTextureAtlas ();
	CATFreeTypeTextureAtlas(unsigned int iWidth, unsigned int iHeight);
	virtual ~CATFreeTypeTextureAtlas ();
	HRESULT CreateTexture (unsigned int iWidth, unsigned int iHeight);
	HRESULT Pack(unsigned char* iBuffer, unsigned int iWidth, unsigned int iHeight, unsigned int iXPadding, unsigned int iYPadding, float* oTexcoords);
	void SetDimensions(unsigned int iWidth, unsigned int iHeight);
	void SetPaddingX(unsigned int _iPad);
	void SetPaddingY(unsigned int _iPad);
	float Width() const; 
	float Height() const;

	//! internal token updated on atlas flush
	unsigned int GetToken() const;

	//! Render texture id
	virtual unsigned int Texture();

	//! The backing texture image
	CATTexturePixelImage* GetTexturePixelImage();

	enum TextureStatus {
		Create = 0,
		Update = 1,
		Ready  = 2
	};
	TextureStatus GetTextureStatus() const;



private:
	void SetTextureStatus(TextureStatus iStatus);
	bool PackingTry(unsigned int iAttempt);
	void UpdateTexture(unsigned char* iBuffer, unsigned int iX, unsigned int iY, unsigned int iWidth, unsigned int iHeight);

	CATFreeTypeTextureAtlas (CATFreeTypeTextureAtlas &);
	CATFreeTypeTextureAtlas& operator=(CATFreeTypeTextureAtlas&);

private:
	unsigned int	_width;
	unsigned int	_height;
	unsigned int _token;	// internal ID
	CATVisRectPacker	_packer;
	unsigned int	_xpad;
	unsigned int	_ypad;

	CATTexturePixelImage* _texture;
	TextureStatus	_textureStatus;
};

//-----------------------------------------------------------------------


#endif // CATFreeTypeTextureAtlas_H
