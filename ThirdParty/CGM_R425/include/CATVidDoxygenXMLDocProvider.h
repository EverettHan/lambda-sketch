#ifndef CATVidDoxygenXMLDocProvider_H
#define CATVidDoxygenXMLDocProvider_H

#include "CATVidDocProvider.h"
#include "VisuDialogEx.h"
#include "CATIDOMNode.h"
#include "CATBaseUnknown.h"
#include "CATUnicodeString.h"

class IntrospectionParserManager;
class CATIXMLPPWriter_var;


/**
 * This class uses documentation generated by doxygen with the xml output format to provide documentation
 * for classes, methods, introspectable properties, enums ...
 * It implements @c CATVidDocProvider
 * Set the name of the folder where the documentation can be found.
 * 
 * @code
 * CATVidDoxygenXMLDocProvider* pDocProvider = new CATVidDoxygenXMLDocProvider(s_inputDir);
 * CATUnicodeString methodDoc = pDocProvider->GetXHTMLMethodDocumentation("Class1", "SetValue");
 * CATUnicodeString formattedMethodDoc = CATVidDocProvider::FormatXHTMLForDocument(methodDoc);
 * (CATVidCtlTextEditor*)pTextEditor->SetXHTMLText(formattedMethodDoc);
 * @endcode
*/
class ExportedByVisuDialogEx CATVidDoxygenXMLDocProvider: public CATVidDocProvider
{
  CATDeclareClass;

public :
  ~CATVidDoxygenXMLDocProvider();
  CATVidDoxygenXMLDocProvider(const CATUnicodeString& i_FolderPath, CATBoolean i_shouldAssert = TRUE);
  /**
   * @param A folder containing the documentation generated by doxygen, in xml format.
   * See @c CATOpenDirectory for paths accepted
   */
  void SetFolderPath(const CATUnicodeString& i_FolderPath);

  /** @copydoc CATVidDocProvider::GetClassDocumentation */
  CATUnicodeString GetClassDocumentation(const CATUnicodeString& i_ClassName, CATBoolean i_FullDoc = FALSE) const;
  /** @copydoc CATVidDocProvider::GetMethodDocumentation */
  CATUnicodeString GetMethodDocumentation(const CATUnicodeString& i_ClassName, const CATUnicodeString& i_MethodName, CATBoolean i_AllowCodeExample = FALSE) const;
  /** @copydoc CATVidDocProvider::GetEnumDocumentation */
  CATUnicodeString GetEnumDocumentation(const CATUnicodeString& i_ClassName, const CATUnicodeString& i_EnumName) const;
  /** @copydoc CATVidDocProvider::GetEnumValueDocumentation */
  CATUnicodeString GetEnumValueDocumentation(const CATUnicodeString& i_ClassName, const CATUnicodeString& i_EnumName, const CATUnicodeString& i_EnumValue) const;

  /** @copydoc CATVidDocProvider::GetXHTMLClassDocumentation */
  CATUnicodeString GetXHTMLClassDocumentation(const CATUnicodeString& i_ClassName, CATBoolean i_FullDoc = FALSE) const;
  /** @copydoc CATVidDocProvider::GetXHTMLMethodDocumentation */
  CATUnicodeString GetXHTMLMethodDocumentation(const CATUnicodeString& i_ClassName, const CATUnicodeString& i_MethodName, CATBoolean i_AllowCodeExample = FALSE) const;
  /** @copydoc CATVidDocProvider::GetXHTMLPropertyDocumentation */
  //CATUnicodeString GetXHTMLPropertyDocumentation(CATUnicodeString i_ClassName, CATUnicodeString i_PropertyName, CATBoolean i_AllowCodeExample = FALSE) const;
  /** @copydoc CATVidDocProvider::GetXHTMLEnumDocumentation */
  CATUnicodeString GetXHTMLEnumDocumentation(const CATUnicodeString& i_ClassName, const CATUnicodeString& i_EnumName) const;
  /** @copydoc CATVidDocProvider::GetXHTMLEnumValueDocumentation */
  CATUnicodeString GetXHTMLEnumValueDocumentation(const CATUnicodeString& i_ClassName, const CATUnicodeString& i_EnumName, const CATUnicodeString& i_EnumValue) const;

private :
  CATUnicodeString _FolderPath;
  CATBoolean _shouldAssert;

  HRESULT GetDocumentFromClassName(const CATUnicodeString& i_ClassName, CATIDOMDocument_var& o_spDocument) const;
  HRESULT GetCompoundDefNode(const CATUnicodeString& i_ClassName, CATIDOMNode_var& o_CompoundDefNode) const;
  HRESULT GetChildNodeFromName(const CATIDOMNode_var& i_Node, const CATUnicodeString& i_ChildName, CATIDOMNode_var& o_ChildNode) const;
  HRESULT GetMethodNode(const CATUnicodeString& i_ClassName, const CATUnicodeString& i_MethodName, CATIDOMNode_var& o_MemberNode) const;
  HRESULT GetEnumNode(const CATUnicodeString& i_ClassName, const CATUnicodeString& i_EnumName, CATIDOMNode_var& o_MemberNode) const;
  HRESULT GetEnumValueNode(const CATUnicodeString& i_ClassName, const CATUnicodeString& i_EnumName, const CATUnicodeString& i_EnumValue, CATIDOMNode_var& o_EnumValueNode) const;
  HRESULT GetNodeNameFromChild(CATIDOMNode_var& i_Node, CATUnicodeString& o_NodeName) const;
  
  HRESULT GetParentClassName(const CATUnicodeString& i_ClassName, CATUnicodeString& o_ParentClassName) const;
  CATUnicodeString GetClassFilePathFromName(const CATUnicodeString& i_ClassName) const;
  CATUnicodeString GetClassIDFromName(const CATUnicodeString& i_ClassName) const;

  CATUnicodeString GetBriefAndDetailedDescription(CATIDOMNode_var i_Node, CATBoolean i_FullDocFlag) const;
  HRESULT GetXHTMLBriefAndDetailedDescription(CATIDOMNode_var i_Node, CATIXMLPPWriter_var& o_xhtmlWriter, CATBoolean i_FullDocFlag) const;
  /** recursive */
  HRESULT RetrieveXHTMLFromNode(CATIDOMNode_var i_Node, CATIXMLPPWriter_var& o_RichTextDescription, CATBoolean i_FullDocFlag) const;
  /** recursive */
  HRESULT RetrieveTextFromNode(CATIDOMNode_var i_Node, CATUnicodeString& o_PlainTextDescription, CATBoolean i_FullDocFlag) const;

  friend class CATVidTstDocProviderTestCATVidDoxygenXMLDocProvider; // For testing
};

#endif //CATVidDoxygenXMLDocProvider_H

