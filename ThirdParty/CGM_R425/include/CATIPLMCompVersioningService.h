// COPYRIGHT Dassault Systemes 2007
//===================================================================
//
// CATIPLMCompVersioningService.h
// Define the CATIPLMCompVersioningService interface
//
//===================================================================
//
// Usage notes:
//
// @level Protected
// @usage U3
//
// Summary:
//    GetAllVersions                  -> Returns the available versions (CATIPLMCompVersion) of a component, based on the component's logicalid (order is not guaranteed)
//    RetrieveVersions                -> Returns the available versions (CATIPLMCompResultVersion) of a component, based on the component's logicalid (order is guaranteed)
//    CheckVersion                    -> Returns the state of the given PLMID: IsLastVersion or IsFirst
//    GetVersioningInfo               -> Returns informations and siblings based on version family
//    GetSpecialMinorModifiedAfter    -> Returns modifications of BSF elements from a particular date
//    GetBSFOfMinorFamily             -> Returns the BSF element of a list of object
//
//===================================================================
//
//  May 2007  Creation: Code generated by the CAA wizard  jvm
//===================================================================
#ifndef CATIPLMCompVersioningService_H
#define CATIPLMCompVersioningService_H

#include "CATPLMServicesItf.h"
#include "CATBaseUnknown.h"
#include "CATCollec.h"
#include "CATTime.h"
#include "CATOmxList.h"
#include "CATOmxArray.h"
#include "CATPLMVersionInfo.h"
#include "CATIPLMError.h"
#include "CATIPLMCompVersion.h"
#include "CATIPLMCompResultVersion.h"
#include "CATPLMOmxCollections.h"

#ifndef LOCAL_DEFINITION_FOR_IID
extern ExportedByCATPLMServicesItf IID IID_CATIPLMCompVersioningService;
#else
extern "C" const IID IID_CATIPLMCompVersioningService;
#endif

class CATPLMID;
class CATLISTV(CATPLMID);
class CATListPtrCATIPLMCompResultVersion;
class CATIPLMCompRecordReadSet;

class ExportedByCATPLMServicesItf CATIPLMCompVersioningService : public CATBaseUnknown
{
  CATDeclareInterface;

public:
  /**
  * Returns the available versions of a component, based on the component's logicalid.
  * These versions belong to the same object family.
  * If there is more than one minor version for a major version, the BSF is returned.
  * Order is not guaranteed in return.
  *
  * @param iRepository [in]
  *   The repository on which the query will be executed. NULL is allowed, then the first connected repository will be used.
  * @param iPLMID [in]
  *   The component's PLMID which versions are required.
  * @param oResults [out]
  *   The version's list. Each object contains the component's identifier (PLMID) and a attribute's key/value block.
  * @param oErrors [out]
  *   Generated errors. Empty means everything ran OK.
  *
  * @return
  *   <code>S_OK</code> if the versions of the component could be retrieved in the database.
  *   <code>E_FAIL</code> if the operation failed.
  */
  virtual HRESULT GetAllVersions(const char* iRepository, CATPLMID& iPLMID, CATOmxList<CATIPLMCompVersion>& oResults, CATOmxList<CATIPLMError>& oErrors) = 0;

  /**
  * Returns the available versions of a component, based on the component's logicalid.
  * These versions belong to the same object family.
  * These versions contain both Major and Minor versions (since the query is based on the logicalid).
  * The returned versions are ordered from the oldest to newest or vice-versa depending on the given iOrderingMode parameter. Order is guaranteed by the server.
  *
  * @param iRepository [in]
  *   The repository on which the query will be executed. NULL is allowed, then the first connected repository will be used.
  * @param iInputList [in]
  *   The component which versions are required.
  * @param oResultsVersion [out]
  *   The result of the query in the database.
  * @param oErrors [out]
  *   Generated errors. Empty means everything ran OK.
  *
  * @return
  *   <code>S_OK</code> if the versions of the component could be retrieved in the database.
  *   <code>E_FAIL</code> if the operation failed.
  */
  enum OrderingMode
  {
    None,
    OlderFirst,
    NewerFirst
  };
  virtual HRESULT RetrieveVersions(const char* iRepository, const CATOmxArray<CATPLMID>& iInputList, OrderingMode iOrderingMode, CATOmxList<CATIPLMCompResultVersion>& oResultsVersion, CATOmxList<CATIPLMError>& oErrors) = 0;

  /**
  * Service to retrieve the Family of major version of all components in input. The family also contains minor versions if any minor versioning was perfomed : the query is based on versionid
  * @param iInputList [in]
  *   The list of PLMIDs which versions are required.
  * @param iProviderName [in]
  *   The Provider Name
  * @param iVersionGraphMode [in]
  *   [NLV project] Defines LinearMode or Graphmode
  * @param iBSFOnly [in]
  *   BSFOnly parameter for query
  * @param oResultsVersion [out]
  *   The result of the query. Map containing the input element and the list of its associated major version family
  * @return
  *   <code>S_OK</code> if the versions of the components could be retrieved in the database.
  *   <code>E_FAIL</code> if the operation failed.
  */
  virtual HRESULT GetMajorVersionFamily(const CATOmxArray<CATPLMID>& iInputList, const CATPLMRepositoryName& iProviderName, CATBoolean iBSFOnly, CATOmxList<CATIPLMCompResultVersion>& oResultsVersion, CATOmxList<CATIPLMError>& oErrors) = 0;

  /**
  * Service to retrieve the Family of minor version of all components in input
  * @param iInputList [in]
  *   The list of PLMIDs which versions are required.
  * @param iProviderName [in]
  *   The Provider Name
  * @param iVersionGraphMode [in]
  *   [NLV project] Defines LinearMode or Graphmode
  * @param iBSFOnly [in]
  *   BSFOnly parameter for query : only the BSF elements are retrieved from the query
  * @param oResultsVersion [out]
  *   The result of the query. Map containing the input element and the list of its associated minor version family
  * @return
  *   <code>S_OK</code> if the versions of the components could be retrieved in the database.
  *   <code>E_FAIL</code> if the operation failed.
  */
  virtual HRESULT GetMinorVersionFamily(const CATOmxArray<CATPLMID>& iInputList, const CATPLMRepositoryName& iProviderName, CATBoolean iBSFOnly, CATOmxList<CATIPLMCompResultVersion>& oResultsVersion, CATOmxList<CATIPLMError>& oErrors) = 0;

  /**
  * Service to retrieve the last version of all components in input
  * @param iInputList [in]
  *   The list of PLMIDs which versions are required.
  * @param iProviderName [in]
  *   The Provider Name
  * @param iVersionGraphMode [in]
  *   [NLV project] Defines LinearMode or Graphmode
  * @param oResultsVersion [out]
  *   The result of the query. Map containing the input element and its last version
  * @return
  *   <code>S_OK</code> if the versions of the components could be retrieved in the database.
  *   <code>E_FAIL</code> if the operation failed.
  */
  virtual HRESULT GetLastVersion(const CATOmxArray<CATPLMID>& iInputList, const CATPLMRepositoryName& iProviderName, CATOmxList<CATIPLMCompResultVersion>& oResultsVersion, CATOmxList<CATIPLMError>& oErrors) = 0;

  /**
  * Returns the state of the given PLMID: IsLastVersion or IsFirst
  *
  * <br><b>Role</b>: Retrieves in the database all versions of components et check for state.
  * try to call provider services first if return E_NOTIMPL use our own implementation.
  * No order is guaranteed in return.
  *
  * @param iPLMIDList [in]
  *   The components list whose versions must be checked.
  * @param iState [in]
  *   versions state to check.
  * @param oResultList [out]
  *   The result list of checked version.
  *   -1 no version found
  *    0 version is not in good state
  *    1 version is in good state
  * @param oErrors [out]
  *   Generated errors. Empty means everything ran OK.
  *
  * @return
  *   <code>S_OK</code> if the versions of the component could be retrieved in the database.
  *   <code>E_FAIL</code> if the operation failed.
  */
  enum VersionState
  {
    IsLastVersion,
    IsFirst
  };
  virtual HRESULT CheckVersion(const char* iRepository, const CATOmxArray<CATPLMID>& iPLMIDList, VersionState iState, CATOmxArray<int>& oResultList, CATOmxList<CATIPLMError>& oErrors) = 0;

  /**
  * Defines a seek mode for major versions retrieval.
  * <dt> <code><b>NoMajor</b></code>   <dd> No major elements are required
  * <dt> <code><b>AllMajor</b></code>  <dd> All major elements are required
  */
  enum MajorSeekMode
  {
    NoMajor = 0,
    AllMajor
  };

  /**
  * Defines a seek mode for minor versions retrieval.
  * <dt> <code><b>NoMinor</b></code>   <dd> No minor elements are required
  * <dt> <code><b>AllMinor</b></code>  <dd> All minor elements are required
  */
  enum MinorSeekMode
  {
    NoMinor = 0,
    AllMinor
  };

  /**
  * Returns informations and siblings based on version family.
  *
  * @param iInputs [in]
  *   The components which versioning informations are required.
  * @param iMajorSeekMode [in]
  *   Tell the service to retrieve major family elements or not.
  * @param iMinorSeekMode [in]
  *   Tell the service to retrieve minor family elements or not.
  * @param oResults [out]
  *   The result of the request from the database. This list is build with all iInputs elements even if there are doublons.
  *   The order of the output may not follow the order of the input list. Use CATPLMVersionInfo::GetElement to retrieve the input if needed.
  *   The CATPLMVersionInfo class links inputs with versioning info and minor / major elements from this particular input.
  *   If an input element launch an error (not found for example), it will not be put inside the ouput list and an error will be return in oErrors.
  * @param oErrors [out]
  *   Generated errors. Empty means everything ran OK.
  */
  virtual HRESULT GetVersioningInfo(const char* iRepository, const CATOmxArray<CATPLMID>& iInputs, MajorSeekMode iMajorSeekMode, MinorSeekMode iMinorSeekMode, CATOmxArray<CATPLMVersionInfo*>& oResults, CATOmxList<CATIPLMError>& oErrors) = 0;

  /**
  * Returns modifications of BSF elements from a particular date.
  *
  * @param iDate [in]
  *   The date from where to find BSF modifications.
  * @param oResultsVersion [out]
  *   The result of the request from the database.
  *   This list is build with all minor elements which are the new BSF of their family after iDate.
  *   There is only minor information inside the result (no major information nor associated major / minor).
  * @param oErrors [out]
  *   Generated errors. Empty means everything ran OK.
  */
  virtual HRESULT GetSpecialMinorModifiedAfter(const char* iRepository, const CATTime& iDate, CATIPLMCompRecordReadSet*& oResultsVersion, CATOmxList<CATIPLMError>& oErrors) = 0;

  /**
  * Returns the BSF element of a list of object.
  *
  * @param iInputs [in]
  *   The list of element to check.
  *   The request automaticaly filtered unwanted elements (Not Simple / Not saved / Instances / etc…).
  * @param oResultsVersion [out]
  *   The result of the request from the database.
  *   One output is generated for each input.
  *   Filtered elements have an Error 'No BSF associated' generated inside the CATIPLMCompResultVersion.
  *   Check the error before asking the GetIdentifiers method.
  * @param oErrors [out]
  *   Generated errors. Empty means everything ran OK.
  */
  virtual HRESULT GetBSFOfMinorFamily(const char* iRepository, const CATOmxArray<CATPLMID>& iInputs, CATOmxList<CATIPLMCompResultVersion>& oResultsVersion, CATOmxList<CATIPLMError>& oErrors) = 0;

  /*
  * DEPRECATED
  */
  enum QueryMode { Last, All };
  enum StabilityMode { Any };
  virtual HRESULT RetrieveVersions(const char* iRepository, const CATLISTV(CATPLMID)& iInputList, QueryMode iQueryMode, StabilityMode iStabilityMode, OrderingMode iOrderingMode, CATLISTP(CATIPLMCompResultVersion)& oResultsVersion) = 0;
  virtual HRESULT CheckVersion(const char* iRepository, const CATLISTV(CATPLMID)& iPLMIDList, VersionState iState, CATListOfInt* oResultList) = 0;
  virtual HRESULT GetSpecialMinorModifiedAfter(const char* iRepository, const CATTime& iDate, CATIPLMCompRecordReadSet*& oResultsVersion) = 0;
};

#endif
