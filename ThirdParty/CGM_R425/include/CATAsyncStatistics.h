//===================================================================
// COPYRIGHT Dassault Systemes 2017/11/15
//===================================================================
// CATAsyncStatistics.cpp
// Header definition of class CATAsyncStatistics
//===================================================================
//
// Usage notes:
// This basic interface represents a statistics object in the async platform.
//
//===================================================================
//  2017/11/15 Creation: Code generated by the 3DS wizard
//===================================================================

#ifndef CATAsyncStatistics_H
#define CATAsyncStatistics_H

#include "CATAsyncTasksPlatform_NG.h"
#include "CATOmxSharable.h"
#include "CATOmxJsonObject.h"
#include "CATOmxCollecManager.h"
#include "CATOmxKeyString.h"
#include "CATTime.h"

class ExportedByCATAsyncTasksPlatform CATAsyncStatistics : public CATOmxSharable
{
public:
  CATAsyncStatistics();
  virtual ~CATAsyncStatistics();

  /*
  * Returns name of the statistics
  */
  virtual CATUnicodeString GetName() const = 0;

  /**
  * Returns statistics as Json format.
  *
  * @param [oStatistics] [out]
  *    the statistics as Json format.
  *
  * @return
  *   S_OK:     Statistics correctly returned as Json
  *   E_FAIL:   Cannot return statistics
  */
  virtual HRESULT GetJson(CATOmxJsonObject& oStatistics) = 0;

  /**
  * Aggregate the given statistics to the current one.
  * These statistics will be dumped in the array "tasks".
  * Example:
  *   {
  *     "logicaltask_name": {... the logical task statistics ...},
  *     "tasks": [iStatistics.GetJson(), ...]
  *   }
  *
  * @param [iStatistics] [in]
  *    the statistics to add
  *
  * @return
  *   S_OK:     Statistics correctly added
  *   E_FAIL:   Cannot add statistics
  */
  virtual HRESULT AddStatistics(CATAsyncStatistics& iStatistics) = 0;

protected:
  /*
  * Tools to dump times and elapses
  */
  static void _DumpTime(const CATOmxKeyString& iKey, const CATTime& iTime, CATOmxJsonObject& ioJson);
  static void _DumpTime(const CATOmxKeyString& iKey, const CATTime& iTime, CATLONG64 iTimestampMs, CATOmxJsonObject& ioJson);
  static void _DumpElaspeMs(const CATOmxKeyString& iKey, CATLONG64 iStartTime, CATLONG64 iEndTime, CATOmxJsonObject& ioJson);
  static void _DumpElaspeMs(const CATOmxKeyString& iKey, CATLONG64 iElapse, CATOmxJsonObject& ioJson);
};

template<> CATOmxCollecManager& CATOmxDefaultCollecManager<CATAsyncStatistics*>::manager();

#endif
