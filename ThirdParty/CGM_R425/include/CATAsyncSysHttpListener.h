//===================================================================
// COPYRIGHT Dassault Systemes 2018/01/22
//===================================================================
// CATAsyncSysHttpListener.cpp
// Header definition of class CATAsyncSysHttpListener
//===================================================================
//
// Usage notes:
// Callback order:
//  RequestStared
//    SIDLWriteStarted (or not)
//      WriteStarted
//      WriteEnded
//      …
//    SIDLWriteEnded (or not)
//    ...
//  RequestSent
//    SIDLReadStarted (or not)
//      ReadStarted
//      ReadEnded
//      …
//    SIDLReadEnded (or not)
//    ...
//  RequestEnded
//
//===================================================================
//  2018/01/22 Creation: Code generated by the 3DS wizard
//===================================================================

#ifndef CATAsyncSysHttpListener_H
#define CATAsyncSysHttpListener_H

#include "CATAsyncTasksPlatform_NG.h"
#include "CATAsyncSysHttpStatistics.h"
#include "CATOmxSR.h"
#include "CATOmxJsonObject.h"
#include "CATOmxJsonArray.h"
#include "DSYSysHTTPPerfInfoCB.h"

class ExportedByCATAsyncTasksPlatform CATAsyncSysHttpListener : public DSYSysHTTPPerfInfoCB
{
public:
  CATAsyncSysHttpListener(CATAsyncSysHttpStatistics* ipSysHttpStatistics);
  virtual ~CATAsyncSysHttpListener();

  virtual HRESULT RequestStarted(CATULONG64 iTime);
  virtual HRESULT RequestSent(CATULONG64 iTime, CATULONG64 iSIDLNBWrite, CATULONG64 iNBWrite);
  virtual HRESULT RequestEnded(CATULONG64 iTime, CATULONG64 iSIDLNBRead, CATULONG64 iNBRead);

  virtual HRESULT WriteStarted(CATULONG64 iTime);
  virtual HRESULT WriteEnded(CATULONG64 iTime);

  virtual HRESULT SIDLWriteStarted(CATULONG64 iTime);
  virtual HRESULT SIDLWriteEnded(CATULONG64 iTime);

  virtual HRESULT ReadStarted(CATULONG64 iTime);
  virtual HRESULT ReadEnded(CATULONG64 iTime);

  virtual HRESULT SIDLReadStarted(CATULONG64 iTime);
  virtual HRESULT SIDLReadEnded(CATULONG64 iTime);

private:
  CATAsyncSysHttpListener (CATAsyncSysHttpListener &);
  CATAsyncSysHttpListener& operator=(CATAsyncSysHttpListener&);

  void _PostError(const CATOmxKeyString& iError);

  CATOmxSR<CATAsyncSysHttpStatistics> _spSysHttpStatistics;
  CATOmxJsonObject _Json;
  CATOmxJsonArray _JsonArrayWrite;
  CATOmxJsonArray _JsonArraySIDLWrite;
  CATOmxJsonArray _JsonArrayRead;
  CATOmxJsonArray _JsonArraySIDLRead;
  CATOmxJsonArray _JsonArrayError;

  bool _IsSIDLWriteStarted;
  bool _IsWriteStarted;
  CATOmxJsonObject _CurrentJsonWrite;
  CATOmxJsonObject _CurrentJsonSIDLWrite;

  bool _IsSIDLReadStarted;
  bool _IsReadStarted;
  CATOmxJsonObject _CurrentJsonRead;
  CATOmxJsonObject _CurrentJsonSIDLRead;
};

#endif
