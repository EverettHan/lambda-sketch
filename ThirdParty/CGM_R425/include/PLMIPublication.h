// COPYRIGHT Dassault Systemes 2009
//===================================================================
//
// PLMIPublication.h
// Define the PLMIPublication interface
//
//===================================================================
//
// Usage notes:
//   New interface: describe its use here
//
//===================================================================
//
//  Mar 2009  Creation: Code generated by the CAA wizard  lvt
//===================================================================
#ifndef PLMIPublication_H
#define PLMIPublication_H

/**
 * @level Protected
 * @usage U3
 */

#include "CATPLMModelerPublicationItf.h"
#include "CATBaseUnknown.h"
#include "CATBoolean.h"

#ifndef LOCAL_DEFINITION_FOR_IID
extern ExportedByCATPLMModelerPublicationItf IID IID_PLMIPublication;
#else
extern "C" const IID IID_PLMIPublication ;
#endif

// --- Forward declaration
class CATILinkableObject_var;
class CATUnicodeString;
class PLMIOmbVirtualObjectDescriptor_var;
class PLMIOmbVirtualObjectDescriptor;
template<typename T> class CATOmxSR;

//------------------------------------------------------------------

/**
 * Interface to manage Publication.
 *
 * <br><b>Role</b>: This interface provides access and modification to the Publication attributes.
 * <p> A Publication is a PLM object which can expose Part geometry or Product Structure objects that
 * would not be accessible otherwise. Its owner (eg its aggregating object) is a PLM Reference object and adheres
 * to the @href PLMIPublications interface.</p>
 * <br><br> A Publication is a persistent object defined by the two following attributes:
 *   <ul>
 *     <li>a Name which should conform to the following rules:
 *   <ul>
 *    <li>It must be unique within the context of its owner.</li>
 *    <li>It must not be empty nor include following characters: '!' , ':' , '<' , '>' </li>
 *    <li>It must not be ended by a blank: for example "<tt>Invalid_Publication_Name </tt>" is forbidden.</li>
 *   </ul>
 *   </li>
 *     <li>a pointed (<b>Published</b>) object which can be:
 *   <ul>
 *    <li>A Virtual Object: (@href CATIOmbUniversalLink::GetReferencedObject) referencing
 *    the object pointed by the Publication.<br>
 *    The exposed object can be a geometry (line, point, ...), a parameter (formula, dimension, ...) or another Publication.</li>
 *    <li>Or empty.</li>
 *   </ul>
 *   </li>
 *   </ul>
 *
 * To create a Publication object, refer to the @href PLMIPublications interface.
 */
class ExportedByCATPLMModelerPublicationItf PLMIPublication: public CATBaseUnknown
{
  CATDeclareInterface;

public:
   /**
    * Publication's Type Mask.
    * @param  SinglePublication
    * @param  PublicationOfPublication
    *
    * Status of the Pointed object's Mask
    * @param  Pointed_Solved     - The pointed object exists and is found
    * @param  Pointed_None       - No pointed object
    * @param  Pointed_Unsolved   - The pointed object cannot be found
    * @param  Pointed_NotSynchro - The pointed object is not synchronized
    * 
    */
   enum Properties
   {
     PublicationTypeMask      = 0x0001,
     SinglePublication        = 0x0000,
     PublicationOfPublication = 0x0001,
     
     PointedObjectMask        = 0x0070,
     Pointed_Solved           = 0x0000,
     Pointed_None             = 0x0010,
     Pointed_Unsolved         = 0x0020,
     Pointed_NotSynchro       = 0x0040,

     All                      = -1
   };

#ifdef CATIAR425
   /**
    *Type of the publication
     * @param  PubType_SinglePublication - The publication is a simple one
     * @param  PubType_PublicationOfPublication - The publication is a publication of publication
     * @param  PubType_Undefined - The publication cannot be found
     *
    */
   enum class PublicationType
   {
     PubType_SinglePublication        = 0,
     PubType_PublicationOfPublication = 1,
     PubType_Undefined = 2
   };

   /**
    *Status of the pointed object
      * @param  PointedObject_Solved - The pointed object exists and is found
      * @param  PointedObject_None - No pointed object
      * @param  PointedObject_Unsolved - The pointed object cannot be found
      * @param  PointedObject_NotSynchro - The pointed object is not synchronized
      *
     */
   enum class PointedObjectStatus
   {
     PointedObject_Solved      = 0,
     PointedObject_None        = 1,
     PointedObject_Unsolved    = 2,
     PointedObject_NotSynchro  = 3
   };

  /**
   *Status of the relation to the pointed object
     * @param Relation_InSession - The pointed object exists and is found
     * @param Relation_NotInSession - The pointed object exists and is not in session
     * @param Relation_Broken - The pointed object cannot be found
     *
    */
   enum class RelationStatus
   {
     Relation_InSession    = 0,
     Relation_NotInSession = 1,
     Relation_Broken       = 2
   };

   /**
    *Status of the publication
      * @param publicationType - The type of the publication
      * @param pointedObjectStatus - The status of the pointed object
      * @param relationStatus - The status of the relation to the pointed object
      *
     */
   struct PLMPublicationProperties
   {
     PLMPublicationProperties() { publicationType = PLMIPublication::PublicationType::PubType_Undefined;
                                  pointedObjectStatus = PLMIPublication::PointedObjectStatus::PointedObject_None;
                                  relationStatus = PLMIPublication::RelationStatus::Relation_Broken;
                                 }

     PLMIPublication::PublicationType publicationType;
     PLMIPublication::PointedObjectStatus pointedObjectStatus;
     PLMIPublication::RelationStatus relationStatus;
   };
#endif

   /**
    *   Retrieves the Publication name.
    *   <br><b>Role</b>: This method retrieves the Publication name which is always valuated.
    *
    *   @param oPublicationName
    *      The Publication name.<br>It is <tt>NULL</tt> if the method fails.
    *   @return
    *      An HRESULT value. 
    *      <br><b>Legal values</b>:
    *      <dl>
    *     <dt><tt>S_OK</tt></dt>
    *     <dd>The Publication name was successfully retrieved.</dd>
    *     <dt><tt>E_FAIL</tt></dt>
    *     <dd>The Publication name search failed.</dd>
    *   </dl>
    */
    virtual HRESULT GetName (CATUnicodeString & oPublicationName) = 0;

   /**
    *   Sets or removes the Publication pointed object.
    *   <br><b>Role</b>: This method sets the Publication pointed object to a new one or removes it.
    *   <br>If the Publication already points an object, the previous pointed object is replaced.
    *
    *   @param ispPointedObject
    *      The new Publication pointed object. It can be a VO (@href CATIOmbUniversalLink::GetReferencedObject) or <tt>NULL</tt> (for removal).
    *   @return
    *      An HRESULT value. 
    *      <br><b>Legal values</b>:
    *      <dl>
    *      <dt><tt>S_OK</tt></dt>
    *      <dd>The new Publication pointed object was successfully set.</dd>
    *      <dt><tt>E_FAIL if the Setting of the Publication fails with the given information.</tt></dt>
    *           Use @href CATError#CATGetLastError to retrieve this error.
    *           <ul>
    *             <li><tt>ProductERR_2309</tt>:</li>
    *                The element can not be published : publications can only be created on references.
    *             <li><tt>ProductERR_2310</tt>:</li>
    *                The element can not be published : error while trying to set the publication to the selected target.
    *   </dl>
    */
    virtual HRESULT SetPointed (const CATILinkableObject_var & ispPointedObject) = 0;

   /**
    *   Retrieves the object pointed by the Publication.
    *   <br><b>Role</b>: This method retrieves the object pointed by the Publication. It can be a VO (@href CATIOmbVirtualObject) or <tt>NULL</tt>.
    *
    *   @param ospPointedObject
    *      The Publication pointed object. It should not be valuated before the call.
    *   @return
    *      An HRESULT value. 
    *      <br><b>Legal values</b>:
    *      <dl>
    *      <dt><tt>S_OK</tt></dt>
    *      <dd>The object pointed by the Publication is successfully retrieved.</dd>
    *      <dt><tt>S_FALSE</tt></dt>
    *      <dd>The object pointed by the Publication is not valuated.</dd>
    *      <dt><tt>E_INVALIDARG </tt></dt>
    *      <dd>The output parameter is already valuated before the call.</dd>
    *      <dt><tt>E_FAIL</tt></dt>
    *      <dd>The Publication pointed object search failed.</dd>
    *    </dl>
    */
    virtual HRESULT GetPointed (CATILinkableObject_var & ospPointedObject) = 0;
  
   /**
    *   Retrieves the Publication owner. 
    *   <br><b>Role</b>: This method retrieves the PLM Reference aggregating the Publication. This owner adheres to the @href PLMIPublications interface
    *   and is a PLM Reference.
    *
    *   @param ospOwner
    *      The Publication owner.<br>
    *      It must not be valuated prior to the call.
    *   @return
    *      An HRESULT value. 
    *      <br><b>Legal values</b>:
    *      <dl>
    *      <dt><tt>S_OK</tt></dt>
    *      <dd>The Publication owner was successfully retrieved.</dd>
    *      <dt><tt>E_INVALIDARG </tt></dt>
    *      <dd>The output <tt>ohOwner</tt> parameter is already valuated before the call.</dd>
    *      <dt><tt>E_FAIL</tt></dt>
    *      <dd>The Publication owner search failed.</dd>
    *    </dl>
    */
    virtual HRESULT GetOwner (CATBaseUnknown_var & ospOwner) = 0;

   /**
    *   Gets the status of the Publication.
    *   <br><b>Role</b>:The status of a Publication is composed of information on its type (single Publication or Publication of Publication)
    *   and its pointed object (solved, not synchronized, unsolved or none).<br>
    *   The result is a logical OR of the Publication's type and the pointed object's status.
    *
    *   @param oProperties
    *      The status of the Publication.
    *   @param iRequestedStatus
    *      The requested Status. Possible values are:
    *          <ul>
    *             <li> <tt>PublicationTypeMask</tt> for only the type of the Publication,</li>
    *             <li> <tt>PointedObjectMask</tt> for only the status of the pointed object,</li>
    *             <li> <tt>All</tt> for both (default)</li>
    *          </ul>
    *
    *      <p>example of use:</p>
    *      <pre>
    *         PLMIPublication *pMyPublication= … ; 
    *         pMyPublication->GetStatus(oProperties, PLMIPublication::All);
    *         if ((oProperties & PLMIPublication::PublicationTypeMask) == PLMIPublication::SinglePublication ) ) …
    *         if ((oProperties & PLMIPublication:: PointedObjectMask) == PLMIPublication::Pointed_Solved) ) …
    *      </pre>
    *      <ul>
    *      <li>The first test is only possible for <tt>All</tt> and <tt>PublicationTypeMask<tt> requested properties.
    *          <p>The possible returned values can be <tt>PLMIPublication::SinglePublication</tt> or <tt>PLMIPublication::PublicationOfPublication</tt></p>
    *      </li>
    *      <li>The second test is only possible for <tt>All</tt> and <tt>PointedObjectMask<tt> requested properties.
    *          <p>The possible returned values can be <tt>PLMIPublication::Pointed_Solved</tt> or <tt>PLMIPublication::Pointed_None</tt> or 
    *             <tt>PLMIPublication::Pointed_Unsolved</tt></p>
    *      </li>
    *      </ul>
    *    @return
    *      An HRESULT value. 
    *      <br><b>Legal values</b>:
    *      <dl>
    *     <dt><tt>S_OK</tt></dt>
    *     <dd>The Publication status was successfully retrieved.</dd>
    *     <dt><tt>E_FAIL</tt></dt>
    *     <dd>The Publication status failed.</dd>
    *   </dl>
    */  
    virtual HRESULT GetStatus (int & oProperties, int iRequestedStatus = PLMIPublication::All ) = 0;

#ifdef CATIAR425
   /**
    *   Gets the status of the Publication.
    *   <br><b>Role</b>:The status of a Publication is composed of information on its type (single Publication or Publication of Publication),
    *   its pointed object (solved, not synchronized, unsolved or none) and the status of the relation to the pointed object.<br>
    *
    *   @param oProperties
    *      The status of the Publication.
    *
    *      <p>example of use:</p>
    *      <pre>
    *         PLMIPublication *pMyPublication= … ;
    *         pMyPublication->GetStatus(oProperties);
    *         if ((oProperties.publicationType) == PLMIPublication::PublicationType::PublicationType_SinglePublication ) ) …
    *         if ((oProperties.pointedObjectStatus) == PLMIPublication::PointedObjectStatus::PointedObject_Solved) ) …
    *         if ((oProperties.relationStatus) == PLMIPublication::RelationStatus::Relation_InSession) ) …
    *      </pre>
    *    @return
    *      An HRESULT value.
    *      <br><b>Legal values</b>:
    *      <dl>
    *     <dt><tt>S_OK</tt></dt>
    *     <dd>The Publication status was successfully retrieved.</dd>
    *     <dt><tt>E_FAIL</tt></dt>
    *     <dd>The Publication status failed.</dd>
    *   </dl>
    */
    virtual HRESULT GetStatus(PLMPublicationProperties& oProperties) = 0;
#endif

   /**
    *   Retrieves the object pointed from the relation's data.
    *   <br><b>Role</b>: This method retrieves the object pointed by the Pubication. This method is useful in Visu Mode because there
    *   is no other way to retrieve the pointed object.
    *
    *   @param ospPointedObjectRelationalView
    *      The object pointed retrieved from the relation's data.<br>
    *      It must not be valuated prior to the call.
    *   @return
    *      An HRESULT value. 
    *      <br><b>Legal values</b>:
    *      <dl>
    *     <dt><tt>S_OK</tt></dt>
    *     <dd>The pointed object was successfully retrieved.</dd>
    *     <dt><tt>E_INVALIDARG </tt></dt>
    *     <dd>The output <tt>ohPointedObject</tt> parameter is already valuated before the call.</dd>
    *     <dt><tt>E_FAIL</tt></dt>
    *     <dd>The pointed object has not been retrieved.</dd>
    *   </dl>
    */
   virtual HRESULT GetRelationInfo (PLMIOmbVirtualObjectDescriptor_var & ospPointedObjectRelationalView) = 0;

   /**
    *   Sets or removes the Publication pointed object.
    *   <br><b>Role</b>: This method sets the Publication pointed object to a new one or removes it.
    *   <br>If the Publication already points an object, the previous pointed object is replaced.
    *
    *   @param ispPointedObject
    *      The new Publication pointed object. It can be <tt>NULL</tt> (for removal).
    *   @return
    *      An HRESULT value. 
    *      <br><b>Legal values</b>:
    *      <dl>
    *      <dt><tt>S_OK</tt></dt>
    *      <dd>The new Publication pointed object was successfully set.</dd>
    *      <dt><tt>E_FAIL if the Setting of the Publication fails with the given information.</tt></dt>
    *           Use @href CATError#CATGetLastError to retrieve this error.
    *           <ul>
    *             <li><tt>ProductERR_2309</tt>:</li>
    *                The element can not be published : publications can only be created on references.
    *             <li><tt>ProductERR_2310</tt>:</li>
    *                The element can not be published : error while trying to set the publication to the selected target.
    *   </dl>
    */
    virtual HRESULT SetPointed (const PLMIOmbVirtualObjectDescriptor_var & ispPointedObject) = 0;

   /**
    *   Retrieves the object pointed by the Publication.
    *   <br><b>Role</b>: This method retrieves the object pointed by the Publication.<tt>NULL</tt>.
    *
    *   @param ospPointedObject
    *      The Publication pointed object. It should not be valuated before the call.
    *   @return
    *      An HRESULT value. 
    *      <br><b>Legal values</b>:
    *      <dl>
    *      <dt><tt>S_OK</tt></dt>
    *      <dd>The object pointed by the Publication is successfully retrieved.</dd>
    *      <dt><tt>S_FALSE</tt></dt>
    *      <dd>The object pointed by the Publication is not valuated.</dd>
    *      <dt><tt>E_INVALIDARG </tt></dt>
    *      <dd>The output parameter is already valuated before the call.</dd>
    *      <dt><tt>E_FAIL</tt></dt>
    *      <dd>The Publication pointed object search failed.</dd>
    *    </dl>
    */
    virtual HRESULT GetPointed (PLMIOmbVirtualObjectDescriptor_var & ospPointedObject,CATBoolean iUnfold = FALSE, CATBoolean iwithProxy = FALSE) = 0;

#ifdef CATIAR424
    /**
    * Constructs a PLMIOmbVirtualObjectDescriptor of the pointing path to the final target, recursively unfolding pointed publications if any.
    * Similar to GetPointed(PLMIOmbVirtualObjectDescriptor_var & ospPointedObject,CATBoolean iUnfold = TRUE, CATBoolean iwithProxy=TRUE)
    * @return
    * A PLMIOmbVirtualObjectDescriptor if the publication is not empty and no error occurs, nullptr otherwise.
    */
    virtual CATOmxSR<PLMIOmbVirtualObjectDescriptor> GetUnfoldedVOD() = 0;
#endif

	   /**
    *   Synchronize the Publication.
	*   @return
    *      An HRESULT value. 
    *      <br><b>Legal values</b>:
    *      <dl>
    *      <dt><tt>S_OK</tt></dt>
    *      <dd> relation was synchronized successfully.</dd>
    *      <dt><tt>E_NOTIMPL</tt></dt>
    *      <dd>The Synchronize method is not implemented for this object.</dd>
    *      <dt><tt>E_ACCESSDENIED </tt></dt>
	*      <dd> Synchro not authorized.</dd>
	*      <dt><tt>S_FALSE </tt></dt>
	*      <dd> RelationSynchroStatus undefined (pointed object not in session) or neutral (status unrelevant).</dd>
	*      <dt><tt>E_INVALIDARG </tt></dt>
    *      <dd> relation has a synchro disabled status.</dd>
    *      <dt><tt>E_FAIL</tt></dt>
    *      <dd>The Publication synchronization failed.</dd>
    *    </dl>
    */
    virtual HRESULT Synchronize () = 0;

  // No constructors or destructors on this pure virtual base class
  // --------------------------------------------------------------
};

CATDeclareHandler(PLMIPublication, CATBaseUnknown);

//------------------------------------------------------------------

#endif
