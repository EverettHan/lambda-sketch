//===================================================================
// COPYRIGHT DS SolidWorks Corporation 2011/10/26
//===================================================================
// CATFreeTypeFontFile.cpp
// Header definition of class CATFreeTypeFontFile
//===================================================================
//
// Usage notes:
//
//===================================================================
//  2011/10/26 Creation: Code generated by the 3DS wizard
//===================================================================

#ifndef CATFreeTypeFontFile_H
#define CATFreeTypeFontFile_H

#include "SGInfra.h"
#include "CATBaseUnknown.h"
#include "CATBoolean.h"
#include "CATUnicodeString.h"
#include "CATString.h"
#include "CATFreeType.h"


class CATFreeTypeFactory;
//-----------------------------------------------------------------------

class ExportedBySGInfra CATFreeTypeFontFile: public CATBaseUnknown
{
	friend class CATFreeTypeFactory;

public:
	HRESULT SetFontData(CATString const& iFilepath);
	HRESULT SetFontData(unsigned char* iFileData, unsigned int iDataSize);
	
	CATString const& GetFontFile() const;
	unsigned char const* GetFontData() const;
	unsigned int DataSize() const;
	CATBoolean InMemory() const;
	CATUnicodeString const& GetFontName() const;

	CATBoolean GetVdmx() const;
	size_t GetNumVdmxRecords() const;
	unsigned char const* GetVdmxRecords() const;
	HRESULT GetVdmxMetrics(size_t ppem, int* o_ascender, int* o_descender);

private:
	CATBoolean GotData();
	void ReleaseCachedData();
	void SetVdmx(CATBoolean iVal);
	void SetVdmxTable(unsigned char* iTable);
private:
	CATFreeTypeFontFile (CATUnicodeString const& iFontName);
	virtual ~CATFreeTypeFontFile ();
	CATFreeTypeFontFile (CATFreeTypeFontFile &);
	CATFreeTypeFontFile& operator=(CATFreeTypeFontFile const&);

private:
	/*
	Spec of table
	http://www.microsoft.com/typography/otspec/vdmx.htm
	*/
	struct vdmx_header {
		unsigned short version;
		unsigned short numRecs;
		unsigned short numRatios;
	};
	struct vdmx_ratio {
		unsigned char bCharSet;
		unsigned char xRatio;
		unsigned char yStartRatio;
		unsigned char yEndRatio;
	};
	struct vdmx_group {
		unsigned short recs;
		unsigned char startsz;
		unsigned char endsz;
	};
public:
	struct vdmx_record {
		unsigned short yPelHeight;
		short yMax;
		short yMin;
	};
private:
	CATUnicodeString _fontName;
	unsigned char*	 _fontData;
	unsigned int	 _fontDataSize;
	CATString		 _filePath;
	CATBoolean		_vdmx;
	unsigned char*	_vdmxTable;
	size_t			_vdmxRecordOffset;
	size_t			_vdmxRecords;
};

//-----------------------------------------------------------------------

#endif
