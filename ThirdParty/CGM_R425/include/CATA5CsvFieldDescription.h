//===================================================================
// COPYRIGHT Dassault Systemes 2017/09/28
//===================================================================
// CATA5CsvFieldDescription.cpp
// Header definition of class CATA5CsvFieldDescription
//===================================================================
//
// Usage notes:
//
//===================================================================
//  2017/09/28 Creation: Code generated by the 3DS wizard
//===================================================================

#ifndef CATA5CsvFieldDescription_H
#define CATA5CsvFieldDescription_H

#include "CATA5ParserExport.h"
#include "CATOmxCollecManager.h"
#include "CATOmxAny.h"
#include "CATOmxKeyString.h"
#include "CATOmxSR.h"
#include "CATOmxSharable.h"

#include "CATA5TclNode.h"

namespace CATA5
{
  class FieldDescription;
}
template <> ExportedByCATA5Parser CATOmxCollecManager &CATOmxDefaultCollecManager<CATA5::FieldDescription>::manager();

namespace CATA5
{
  /*
  * Abstract any factory for complex type.
  */
  class ExportedByCATA5Parser AnyFactory : public CATOmxSharable
  {
  public:
    AnyFactory() : CATOmxSharable((CATMetaClass*)NULL) {};

    virtual HRESULT Build(const char* iData, int iDataLen, const FieldDescription& iFieldDescription, CATOmxAny& oValue) const = 0;
    virtual CATUnicodeString GetIdentifier() { return "AnyFactory"; };
  };

  /**
  * Csv field description.
  */
  class ExportedByCATA5Parser FieldDescription
  {
  public:
    // Constructor
    FieldDescription();

    // Methods
    HRESULT build_from_tcl(const TclNode*tcl);
    HRESULT build_from_any(const CATOmxAny &proto_def);
    void set_mv_def_value(const CATOmxAny &iDefaultValue);
    void Configure();
    void TCLDump(CATOmxTextStream &iStream, CATBoolean iAddSurroundingBracket = FALSE) const;

    // Attributes
    CATOmxKeyString target_kvb; // target key for this column into kvb
    CATOmxAny mv_def_value; // default value to be used when creating the column (default void)
    CATOmxKind type : 16; // kind of value
    bool copy_to_kvb : 1; // if set columns is copied into kvb
    bool is_multivaluated : 1; // if set multi valuated field
    bool is_select : 1;
    bool with_rank : 1;
    bool without_size : 1;

    bool accept_empty : 1;  // empty value will generate CATOmxAny omx_void in the value
    unsigned char m_flags;
    unsigned char m_flatten; //
    unsigned int  multivaluated_mask; // DEFAULT not set
    unsigned int  set_mask; // DEFAULT not set
    CATOmxSR<AnyFactory> factory; // optional factory
    CATOmxKeyString jsonKey; // the key of the attribute in the returned json. Example: "physicalid" or "attribute[PLMCoreRepReference.V_isOnceInstantiable]"
    CATOmxKeyString jsonPath; // the path of the attribute in the returned json. Example: "" -> in the structure's root, "selectdata", "busselect" or "relselect"

    inline void SetIsSizeOfNextColumn(bool iIsSizeOfNextColumn) {
      _is_sizeofnextcolumn = iIsSizeOfNextColumn;
    }

    inline bool GetIsSizeOfNextColumn() const{
      return _is_sizeofnextcolumn;
    }

  private:
    bool _is_sizeofnextcolumn;
  };
}

#endif
