//===================================================================
// COPYRIGHT Dassault Systemes 2012/06/27
//===================================================================
// CATV3DMouseEventArgs.h
// Header definition of class CATV3DMouseEventArgs
//===================================================================
//
// Usage notes:
//
//===================================================================
//  2012/06/27 Creation: Code generated by the 3DS wizard  JV8
//===================================================================

#ifndef CATV3DMouseEventArgs_H
#define CATV3DMouseEventArgs_H

#include <VisuImmersive3D.h>
#include <CATV3DInputEventArgs.h>
#include <CATBaseUnknown_WR.h>
#include <CATMathPoint2Df.h>
#include <CATMathPoint.h>
#include <CATMathDirection.h>
#include <CATUnicodeString.h>

class CATVizViewer;
class CATPathElement;
class CATV3DWidget;

/** @ingroup V3DGP
 * Dispatching arguments for mouse events of @ref CATV3DGraphicPrimitive.
 *
 * @see CATV3DGraphicPrimitive::Entry CATV3DGraphicPrimitive::Leave CATV3DGraphicPrimitive::Press
 * CATV3DGraphicPrimitive::ReleaseEvt CATV3DGraphicPrimitive::DoubleClick CATV3DGraphicPrimitive::MoveOver
 * CATV3DGraphicPrimitive::RightClick CATV3DGraphicPrimitive::BeginPreDrop CATV3DGraphicPrimitive::EndPreDrop
 * CATV3DGraphicPrimitive::PreDrop CATV3DGraphicPrimitive::Drop
 */
class ExportedByVisuImmersive3D CATV3DMouseEventArgs: public CATV3DInputEventArgs
{
  CATDeclareClass;
public:
  /** 
   * A bitfield representing the pressed keyboard modifiers.
   *
   * Its value must be on or-combination of masks @ref #SHIFT_MASK,
   * @ref #CTRL_MASK and @ref #ALT_MASK.
   *
   * @see #Modifiers2String
   */
  typedef int Modifiers;
  /** the `Shift' key bitfield mask constant. To be used with @ref
      #Modifiers type. */
  static const int SHIFT_MASK;
  /** the `Control' key bitfield mask constant. To be used with @ref
      #Modifiers type. */
  static const int CTRL_MASK;
  /** the `Alt' key bitfield mask constant. To be used with @ref
      #Modifiers type. */
  static const int ALT_MASK;
  /** the combination of all possible masks. Useful to test for
      bitfield validity. To be used with @ref #Modifiers type. */
  static const int ALL_MASKS;
  /**
   * Build a string representation of a modifier bitfield.
   *
   * The returned string is built as a list of tokens separated by a
   * @c '|' character. If the bitfield contains invalid bits, then the
   * token @c "<Invalid>" is appended to the list.
   *
   * This string representation is meant to be used for debugging
   * purpose only. No production code should rely on this
   * representation as it may change without warning.
   *
   * @return the string representation.
   */
  static CATUnicodeString Modifiers2String(Modifiers i_modifiers);
public:
  /** 
   * Initialize this class.
   *
   * @param i_pEvent the event dispatched. Can't be @c NULL.
   * 
   * @param i_timestamp the timestamp in milli-seconds of the
   * interaction represented by the dispatch of the event.
   *
   * @param i_pViewer the viewer in which the event occured. Can't be
   * @c NULL.
   *
   * @param i_mousePositionInViewer the position of the mouse in the
   * viewer.
   */
  CATV3DMouseEventArgs(CATSYPEvent *i_pEvent, 
                       CATULONG32 i_timestamp, 
                       CATVizViewer *i_pViewer,
                       const CATMathPoint2Df &i_mousePositionInViewer, 
                       const CATMathPoint &iPickedPoint, 
                       const CATMathDirection &iNormal,
                       const CATMathDirection &iIndicationSegmentDirection,
                       CATPathElement *i_Path, 
                       Modifiers i_modifiers,
                       int i_ButtonPressed=1);

  /** Destroy this class */
  virtual ~CATV3DMouseEventArgs();

  /**
   * Get the mouse position.
   *
   * The returned position is relative to @a i_pWidget. If not @c
   * NULL, @a i_pWidget must be in the same viewer as the one in which
   * the event occured. If it is not the case a @ref FAILURE will
   * occur and this function will return <code>0.f,0.f</code> as coordinates.
   *
   * This function can't be called if the viewer in which the event
   * occured has been destroyed. In that case a @ref FAILURE will be
   * raised (except when called with @c NULL, in that case it never
   * fails).
   *
   * This class stores the position relative to the viewer and then
   * interprets it when being called on this function. As a
   * consequence the relative position of the mouse to a given widget
   * may change during the dispatch of the event if one of the widget
   * in its parenthood is moved (for example by an other event
   * handler). The initial value may also be inaccurate if some code
   * has moved the widget between the generation of the event in
   * Visualization code and the dispatch of the VID event.<br/>
   * Since the stored position is relative to the viewer, moving the
   * CATViewer itself won't change the returned value.
   *
   * @param i_pWidget the widget. @c NULL if the caller wants to
   * obtain the mouse position in the viewer.
   *
   * @return the mouse position relative to @a i_pWidget or relative
   * to the viewer if @a i_pWidget is @c NULL. It will return
   * <code>0.f,0.f</code> if i_pWidget is not in the correct viewer
   * (in this case a @ref FAILURE) will also be triggered, or if the
   * viewer has been destroyed and @a i_pWidget is not @c NULL. If the
   * viewer has been destroyed an @a i_pWidget is @c NULL then the
   * position in the destroyed viewer will still be returned.
   *
   * @see #GetViewer
   */
  CATMathPoint2Df GetMousePosition(CATV3DWidget *i_pWidget) const;

  CATMathPoint GetPickedElementIntersectionPoint() const;

  CATMathDirection GetElementNormal() const;

  CATMathDirection GetIndicationSegmentDirection() const;
  
  /**
   * Get the viewer in which the event occured.
   *
   * @return the viewer. @c NULL if the viewer has been destroyed or
   * if an internal error occured. No @c AddRef has been done on the
   * returned value.
   */
  CATVizViewer *GetViewer() const;

  /**
   * Get the PathElement on which the event occured.
   *
   * @return the PathElement. @c NULL if the PathElement has been destroyed or
   * if an internal error occured. No @c AddRef has been done on the
   * returned value.
   */
  CATPathElement *GetPathElement() const;

  /**
   * Get the pressed keyboard modifiers.
   *
   * @return the modifiers.
   */
  Modifiers GetModifiers();

  int GetButtonPressed();

private:
  CATV3DMouseEventArgs(const CATV3DMouseEventArgs &);
  CATV3DMouseEventArgs &operator=(const CATV3DMouseEventArgs &);

private:
  /** a weakreference on the @ref CATVizViewer used to defined the
      mouse position */
  const CATBaseUnknown_WR _wrViewer;

  const CATBaseUnknown_var _spPathElement;
  /** the mouse position relative to the viewer @ref #_wrViewer */
  const CATMathPoint2Df _mousePositionInViewer;
  const CATMathPoint _pickedPoint;
  const CATMathDirection _ElementNormal;
  const CATMathDirection _IndicationSegmentDirection;
  /** the bitfield representing modifiers */
  const Modifiers _modifiers;
  const int       _ButtonPressed;
};

#endif // CATV3DMouseEventArgs_H
